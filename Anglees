<!DOCTYPE html>

<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ø±ÙƒØ² Ø­ÙØ¸ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© - Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Playfair+Display:wght@400;700;900&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0f1a;
    --card: #141726;
    --card2: #1a1f35;
    --accent: #c9a84c;
    --accent2: #e8c97a;
    --text: #e8e4d9;
    --text-muted: #8a8499;
    --border: rgba(201,168,76,0.2);
    --green: #4caf82;
    --blue: #4c8ecf;
    --red: #cf4c6a;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Lato', sans-serif;
    min-height: 100vh;
    background-image: 
      radial-gradient(ellipse at 10% 20%, rgba(201,168,76,0.06) 0%, transparent 50%),
      radial-gradient(ellipse at 90% 80%, rgba(76,142,207,0.06) 0%, transparent 50%);
  }

/* HEADER */
header {
background: linear-gradient(135deg, #0d0f1a 0%, #1a1430 100%);
border-bottom: 1px solid var(â€“border);
padding: 0 2rem;
position: sticky; top: 0; z-index: 100;
backdrop-filter: blur(10px);
}
.header-inner {
max-width: 1400px; margin: 0 auto;
display: flex; align-items: center; justify-content: space-between;
padding: 1rem 0;
}
.logo {
display: flex; align-items: center; gap: 12px;
}
.logo-icon {
width: 44px; height: 44px;
background: linear-gradient(135deg, var(â€“accent), var(â€“accent2));
border-radius: 10px;
display: flex; align-items: center; justify-content: center;
font-size: 22px;
}
.logo-text h1 {
font-family: â€˜Amiriâ€™, serif;
font-size: 1.2rem; color: var(â€“accent2);
line-height: 1.2;
}
.logo-text p { font-size: 0.7rem; color: var(â€“text-muted); }

nav { display: flex; gap: 8px; }
nav button {
background: transparent; border: 1px solid transparent;
color: var(â€“text-muted); padding: 8px 16px; border-radius: 8px;
cursor: pointer; font-size: 0.85rem; transition: all 0.2s;
font-family: â€˜Amiriâ€™, serif;
}
nav button:hover, nav button.active {
background: rgba(201,168,76,0.1);
border-color: var(â€“border);
color: var(â€“accent2);
}

/* MAIN */
main { max-width: 1400px; margin: 0 auto; padding: 2rem; }

/* HERO */
.hero {
text-align: center; padding: 3rem 1rem 2rem;
animation: fadeIn 0.8s ease;
}
.hero h2 {
font-family: â€˜Playfair Displayâ€™, serif;
font-size: clamp(2rem, 5vw, 3.5rem);
background: linear-gradient(135deg, var(â€“accent), var(â€“accent2), #fff);
-webkit-background-clip: text; -webkit-text-fill-color: transparent;
margin-bottom: 1rem;
}
.hero p { color: var(â€“text-muted); font-size: 1rem; font-family: â€˜Amiriâ€™, serif; }

/* UPLOAD SECTION */
.upload-section {
background: var(â€“card);
border: 1px solid var(â€“border);
border-radius: 20px; padding: 2rem; margin: 2rem 0;
animation: fadeIn 0.6s ease;
}
.upload-section h3 {
font-family: â€˜Amiriâ€™, serif; font-size: 1.4rem;
color: var(â€“accent2); margin-bottom: 1.5rem;
display: flex; align-items: center; gap: 10px;
}
.upload-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
.upload-zone {
border: 2px dashed var(â€“border);
border-radius: 14px; padding: 2rem;
text-align: center; cursor: pointer;
transition: all 0.3s; position: relative;
}
.upload-zone:hover {
border-color: var(â€“accent);
background: rgba(201,168,76,0.05);
}
.upload-zone input { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; }
.upload-zone .icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
.upload-zone p { font-family: â€˜Amiriâ€™, serif; color: var(â€“text-muted); font-size: 0.9rem; }
.upload-zone strong { color: var(â€“accent2); display: block; font-size: 1rem; margin-bottom: 4px; }

.material-form { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem; }
.form-group { display: flex; flex-direction: column; gap: 6px; }
.form-group.full { grid-column: 1/-1; }
label { font-family: â€˜Amiriâ€™, serif; color: var(â€“accent2); font-size: 0.9rem; }
input[type=text], select, textarea {
background: var(â€“card2); border: 1px solid var(â€“border);
color: var(â€“text); padding: 10px 14px; border-radius: 10px;
font-family: â€˜Latoâ€™, sans-serif; font-size: 0.9rem;
transition: border-color 0.2s; outline: none;
}
input:focus, select:focus, textarea:focus { border-color: var(â€“accent); }
textarea { resize: vertical; min-height: 100px; }

.btn {
padding: 12px 28px; border-radius: 10px; border: none;
cursor: pointer; font-weight: 700; font-size: 0.95rem;
transition: all 0.2s; letter-spacing: 0.5px;
}
.btn-primary {
background: linear-gradient(135deg, var(â€“accent), var(â€“accent2));
color: #0d0f1a;
}
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(201,168,76,0.3); }
.btn-secondary {
background: var(â€“card2); border: 1px solid var(â€“border);
color: var(â€“accent2);
}
.btn-sm { padding: 7px 14px; font-size: 0.8rem; }

/* MATERIALS GRID */
.section-title {
font-family: â€˜Amiriâ€™, serif; font-size: 1.4rem;
color: var(â€“accent2); margin: 2rem 0 1rem;
display: flex; align-items: center; gap: 10px;
padding-bottom: 0.5rem; border-bottom: 1px solid var(â€“border);
}
.materials-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
gap: 1.5rem;
}
.material-card {
background: var(â€“card); border: 1px solid var(â€“border);
border-radius: 18px; padding: 1.5rem;
transition: all 0.3s; cursor: pointer;
position: relative; overflow: hidden;
animation: fadeIn 0.5s ease;
}
.material-card::before {
content: â€˜â€™;
position: absolute; top: 0; left: 0; right: 0; height: 3px;
background: linear-gradient(90deg, var(â€“accent), var(â€“blue));
}
.material-card:hover {
transform: translateY(-4px);
border-color: rgba(201,168,76,0.4);
box-shadow: 0 12px 30px rgba(0,0,0,0.4);
}
.card-type {
display: inline-flex; align-items: center; gap: 5px;
background: rgba(201,168,76,0.1); color: var(â€“accent);
padding: 4px 10px; border-radius: 20px; font-size: 0.75rem;
font-family: â€˜Amiriâ€™, serif; margin-bottom: 0.8rem;
}
.card-title {
font-family: â€˜Playfair Displayâ€™, serif;
font-size: 1.1rem; color: var(â€“text);
margin-bottom: 0.5rem; line-height: 1.4;
}
.card-meta { color: var(â€“text-muted); font-size: 0.8rem; margin-bottom: 1rem; }
.card-actions { display: flex; gap: 8px; flex-wrap: wrap; }

/* STUDY PLAN MODAL */
.modal-overlay {
position: fixed; inset: 0; z-index: 200;
background: rgba(0,0,0,0.8); backdrop-filter: blur(8px);
display: flex; align-items: center; justify-content: center;
padding: 1rem;
opacity: 0; pointer-events: none; transition: opacity 0.3s;
}
.modal-overlay.open { opacity: 1; pointer-events: all; }
.modal {
background: var(â€“card);
border: 1px solid var(â€“border);
border-radius: 24px; width: 100%; max-width: 900px;
max-height: 90vh; overflow-y: auto;
padding: 2rem; position: relative;
transform: translateY(30px); transition: transform 0.3s;
}
.modal-overlay.open .modal { transform: translateY(0); }
.modal-close {
position: absolute; top: 1rem; left: 1rem;
background: var(â€“card2); border: 1px solid var(â€“border);
color: var(â€“text); width: 36px; height: 36px;
border-radius: 50%; cursor: pointer; font-size: 1rem;
display: flex; align-items: center; justify-content: center;
}

/* STUDY PLAN */
.study-plan-header {
text-align: center; margin-bottom: 2rem;
padding-bottom: 1.5rem; border-bottom: 1px solid var(â€“border);
}
.study-plan-header h2 {
font-family: â€˜Playfair Displayâ€™, serif;
font-size: 1.8rem; color: var(â€“accent2);
margin-bottom: 0.5rem;
}
.plan-tabs { display: flex; gap: 8px; margin-bottom: 1.5rem; flex-wrap: wrap; }
.plan-tab {
padding: 8px 18px; border-radius: 20px;
border: 1px solid var(â€“border); background: transparent;
color: var(â€“text-muted); cursor: pointer;
font-family: â€˜Amiriâ€™, serif; transition: all 0.2s;
}
.plan-tab.active {
background: linear-gradient(135deg, var(â€“accent), var(â€“accent2));
color: #0d0f1a; border-color: transparent; font-weight: 700;
}
.plan-content { display: none; }
.plan-content.active { display: block; animation: fadeIn 0.4s; }

.day-card {
background: var(â€“card2); border: 1px solid var(â€“border);
border-radius: 14px; padding: 1.2rem; margin-bottom: 1rem;
}
.day-title {
display: flex; justify-content: space-between; align-items: center;
margin-bottom: 0.8rem;
}
.day-title h4 { font-family: â€˜Amiriâ€™, serif; color: var(â€“accent); font-size: 1rem; }
.day-badge {
background: rgba(76,175,130,0.15); color: var(â€“green);
padding: 3px 10px; border-radius: 20px; font-size: 0.75rem;
}
.task-list { list-style: none; }
.task-list li {
display: flex; align-items: flex-start; gap: 10px;
padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
font-size: 0.88rem; line-height: 1.5;
}
.task-list li:last-child { border-bottom: none; }
.task-num {
background: rgba(201,168,76,0.2); color: var(â€“accent);
width: 22px; height: 22px; border-radius: 50%;
display: flex; align-items: center; justify-content: center;
font-size: 0.75rem; flex-shrink: 0;
}

/* PRONUNCIATION */
.pronunciation-box {
background: var(â€“card2); border-radius: 12px; padding: 1.2rem;
margin: 1rem 0; border: 1px solid var(â€“border);
}
.phonetic {
font-family: â€˜Latoâ€™, sans-serif; font-size: 1.3rem;
color: var(â€“blue); letter-spacing: 2px;
margin-bottom: 0.5rem;
}
.pronunciation-words { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 1rem; }
.word-chip {
background: var(â€“card); border: 1px solid var(â€“border);
border-radius: 8px; padding: 6px 12px;
cursor: pointer; transition: all 0.2s;
display: flex; align-items: center; gap: 6px;
}
.word-chip:hover { border-color: var(â€“accent); background: rgba(201,168,76,0.05); }
.word-chip .eng { font-size: 0.9rem; color: var(â€“text); }
.word-chip .ar { font-family: â€˜Amiriâ€™, serif; font-size: 0.85rem; color: var(â€“text-muted); }
.word-chip .sound { color: var(â€“accent); font-size: 0.8rem; }

/* TIPS */
.tips-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem; }
.tip-card {
background: var(â€“card2); border-radius: 12px; padding: 1rem;
border-right: 3px solid var(â€“accent);
}
.tip-card h5 { font-family: â€˜Amiriâ€™, serif; color: var(â€“accent2); margin-bottom: 6px; }
.tip-card p { font-family: â€˜Amiriâ€™, serif; font-size: 0.85rem; color: var(â€“text-muted); line-height: 1.6; }

/* PROGRESS */
.progress-section { margin: 2rem 0; }
.progress-card {
background: var(â€“card); border: 1px solid var(â€“border);
border-radius: 16px; padding: 1.5rem;
}
.stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
.stat { text-align: center; }
.stat-num { font-family: â€˜Playfair Displayâ€™, serif; font-size: 2rem; color: var(â€“accent); }
.stat-label { font-family: â€˜Amiriâ€™, serif; font-size: 0.8rem; color: var(â€“text-muted); }
.progress-bar-wrap { margin-top: 0.5rem; }
.progress-label { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 4px; }
.progress-bar { height: 8px; background: var(â€“card2); border-radius: 4px; overflow: hidden; }
.progress-fill { height: 100%; border-radius: 4px; transition: width 1s ease; }

/* EMPTY STATE */
.empty-state {
text-align: center; padding: 4rem 2rem;
color: var(â€“text-muted);
}
.empty-state .icon { font-size: 4rem; margin-bottom: 1rem; }
.empty-state p { font-family: â€˜Amiriâ€™, serif; font-size: 1.1rem; }

/* AI LOADING */
.ai-thinking {
display: flex; align-items: center; gap: 12px;
background: rgba(201,168,76,0.08); border: 1px solid var(â€“border);
border-radius: 12px; padding: 1rem 1.5rem; margin: 1rem 0;
}
.spinner {
width: 24px; height: 24px; border: 3px solid var(â€“border);
border-top-color: var(â€“accent); border-radius: 50%;
animation: spin 0.8s linear infinite; flex-shrink: 0;
}
.ai-thinking p { font-family: â€˜Amiriâ€™, serif; color: var(â€“accent2); }

@keyframes spin { to { transform: rotate(360deg); } }
@keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }

/* RESPONSIVE */
@media (max-width: 768px) {
.upload-grid, .material-form, .tips-grid, .stats { grid-template-columns: 1fr; }
nav { display: none; }
}

/* SCROLLBAR */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(â€“bg); }
::-webkit-scrollbar-thumb { background: var(â€“border); border-radius: 3px; }

.highlight-text {
background: linear-gradient(120deg, rgba(201,168,76,0.15), rgba(76,142,207,0.1));
border: 1px solid rgba(201,168,76,0.2);
border-radius: 10px; padding: 1rem;
font-family: â€˜Amiriâ€™, serif; line-height: 1.8;
}
.en-text { font-family: â€˜Playfair Displayâ€™, serif; color: var(â€“accent2); }
.ar-text { color: var(â€“text); }

.tag {
display: inline-block; padding: 3px 10px; border-radius: 20px;
font-size: 0.72rem; margin: 2px;
}
.tag-essay { background: rgba(201,168,76,0.15); color: var(â€“accent); }
.tag-passage { background: rgba(76,142,207,0.15); color: var(â€“blue); }
.tag-literature { background: rgba(207,76,130,0.15); color: var(â€“red); }

#toast {
position: fixed; bottom: 2rem; right: 2rem; z-index: 999;
background: var(â€“green); color: #fff; padding: 12px 24px;
border-radius: 10px; font-family: â€˜Amiriâ€™, serif;
transform: translateY(80px); opacity: 0; transition: all 0.3s;
}
#toast.show { transform: translateY(0); opacity: 1; }

.voice-btn {
background: rgba(76,142,207,0.15); border: 1px solid rgba(76,142,207,0.3);
color: var(â€“blue); padding: 6px 14px; border-radius: 8px;
cursor: pointer; font-size: 0.8rem; transition: all 0.2s;
display: inline-flex; align-items: center; gap: 5px;
}
.voice-btn:hover { background: rgba(76,142,207,0.3); }
.voice-btn.playing { background: var(â€“blue); color: #fff; animation: pulse 1s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.7} }
</style>

</head>
<body>

<header>
  <div class="header-inner">
    <div class="logo">
      <div class="logo-icon">ğŸ“š</div>
      <div class="logo-text">
        <h1>Ù…Ø±ÙƒØ² Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</h1>
        <p>Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ | Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ù„Ø£Ø¯Ø¨ ÙˆØ§Ù„Ù‚Ø·Ø¹</p>
      </div>
    </div>
    <nav>
      <button class="active" onclick="showPage('home')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      <button onclick="showPage('materials')">Ø§Ù„Ù…ÙˆØ§Ø¯</button>
      <button onclick="showPage('progress')">Ø§Ù„ØªÙ‚Ø¯Ù…</button>
    </nav>
  </div>
</header>

<main>
  <!-- HOME PAGE -->
  <div id="page-home">
    <div class="hero">
      <h2>Ø§Ø­ÙØ¸ ÙˆØªØ¹Ù„Ù‘Ù… Ø¨Ø°ÙƒØ§Ø¡</h2>
      <p>Ø£Ø¶Ù Ù…ÙˆØ§Ø¯ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø®Ø·Ø© Ø¯Ø±Ø§Ø³Ø© Ø°ÙƒÙŠØ© Ù…Ø¹ Ù†Ø·Ù‚ ØµÙˆØªÙŠ ÙˆÙ…ÙƒØªÙˆØ¨</p>
    </div>

```
<!-- UPLOAD -->
<div class="upload-section">
  <h3>â• Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
  
  <div class="material-form">
    <div class="form-group">
      <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø§Ø¯Ø© (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©)</label>
      <input type="text" id="matTitle" placeholder="Ù…Ø«Ø§Ù„: My Hobby Essay">
    </div>
    <div class="form-group">
      <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø©</label>
      <select id="matType">
        <option value="essay">Ø¥Ù†Ø´Ø§Ø¡ (Essay)</option>
        <option value="passage">Ù‚Ø·Ø¹Ø© Ù‚Ø±Ø§Ø¡Ø© (Reading Passage)</option>
        <option value="literature">Ù‚Ø·Ø¹Ø© Ø£Ø¯Ø¨ÙŠØ© (Literature)</option>
      </select>
    </div>
    <div class="form-group full">
      <label>Ø§Ù„Ù†Øµ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ (Ø£Ùˆ Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„Ù…Ù„Ù)</label>
      <textarea id="matText" placeholder="Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ù‡Ù†Ø§..."></textarea>
    </div>
    <div class="form-group full">
      <label>Ø§Ù„ØªØ±Ø¬Ù…Ø© / Ø§Ù„Ù…Ø¹Ù†Ù‰ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
      <textarea id="matArabic" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø£Ùˆ Ø§Ù„Ù…Ù„Ø®Øµ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ..." style="min-height:70px"></textarea>
    </div>
  </div>

  <div class="upload-grid" style="margin-top:1rem">
    <div class="upload-zone">
      <input type="file" id="imgUpload" accept="image/*" onchange="handleFileUpload(this,'img')">
      <div class="icon">ğŸ–¼ï¸</div>
      <strong>Ø±ÙØ¹ ØµÙˆØ±Ø©</strong>
      <p>Ø§Ø³Ø­Ø¨ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø§Ø¯Ø©</p>
    </div>
    <div class="upload-zone">
      <input type="file" id="pdfUpload" accept=".pdf" onchange="handleFileUpload(this,'pdf')">
      <div class="icon">ğŸ“„</div>
      <strong>Ø±ÙØ¹ Ù…Ù„Ù PDF</strong>
      <p>Ø§Ø³Ø­Ø¨ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ù…Ù„Ù Ø¨ÙŠ Ø¯ÙŠ Ø§Ù</p>
    </div>
  </div>

  <div id="filePreview" style="margin-top:1rem;display:none"></div>

  <div style="margin-top:1.5rem; display:flex; gap:10px; justify-content:flex-end">
    <button class="btn btn-secondary" onclick="clearForm()">Ù…Ø³Ø­</button>
    <button class="btn btn-primary" onclick="addMaterial()">âœ¨ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</button>
  </div>
</div>

<!-- QUICK STATS -->
<div class="progress-section">
  <div class="progress-card">
    <div class="stats">
      <div class="stat">
        <div class="stat-num" id="totalMat">0</div>
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯</div>
      </div>
      <div class="stat">
        <div class="stat-num" id="essayCount">0</div>
        <div class="stat-label">Ø¥Ù†Ø´Ø§Ø¡Ø§Øª</div>
      </div>
      <div class="stat">
        <div class="stat-num" id="passageCount">0</div>
        <div class="stat-label">Ù‚Ø·Ø¹ Ù‚Ø±Ø§Ø¡Ø©</div>
      </div>
      <div class="stat">
        <div class="stat-num" id="litCount">0</div>
        <div class="stat-label">Ù‚Ø·Ø¹ Ø£Ø¯Ø¨ÙŠØ©</div>
      </div>
    </div>
    <div class="progress-bar-wrap">
      <div class="progress-label"><span style="font-family:Amiri">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙƒÙ„ÙŠØ©</span><span id="totalPct">0%</span></div>
      <div class="progress-bar"><div class="progress-fill" id="mainProgress" style="width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2))"></div></div>
    </div>
  </div>
</div>

<!-- RECENT MATERIALS -->
<div class="section-title">ğŸ“– Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø¶Ø§ÙØ©</div>
<div id="materialsContainer">
  <div class="empty-state">
    <div class="icon">ğŸ“</div>
    <p>Ù„Ù… ØªÙØ¶Ù Ø£ÙŠ Ù…Ø§Ø¯Ø© Ø¨Ø¹Ø¯. Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø¥Ù†Ø´Ø§Ø¡ Ø£Ùˆ Ù‚Ø·Ø¹Ø©!</p>
  </div>
</div>
```

  </div>

  <!-- MATERIALS PAGE -->

  <div id="page-materials" style="display:none">
    <div class="section-title">ğŸ“š Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯</div>
    <div id="allMaterialsContainer"></div>
  </div>

  <!-- PROGRESS PAGE -->

  <div id="page-progress" style="display:none">
    <div class="section-title">ğŸ“Š ØªÙ‚Ø¯Ù…ÙŠ ÙÙŠ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</div>
    <div id="progressContainer"></div>
  </div>
</main>

<!-- STUDY PLAN MODAL -->

<div class="modal-overlay" id="studyModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">âœ•</button>
    <div id="modalContent"></div>
  </div>
</div>

<div id="toast">ØªÙ… Ø¨Ù†Ø¬Ø§Ø­! âœ“</div>

<script>
// ============= DATA =============
let materials = JSON.parse(localStorage.getItem('eng_materials') || '[]');

const typeMap = {
  essay: { label: 'Ø¥Ù†Ø´Ø§Ø¡', icon: 'âœï¸', tagClass: 'tag-essay' },
  passage: { label: 'Ù‚Ø·Ø¹Ø© Ù‚Ø±Ø§Ø¡Ø©', icon: 'ğŸ“–', tagClass: 'tag-passage' },
  literature: { label: 'Ù‚Ø·Ø¹Ø© Ø£Ø¯Ø¨ÙŠØ©', icon: 'ğŸ“œ', tagClass: 'tag-literature' }
};

// ============= NAVIGATION =============
function showPage(page) {
  ['home','materials','progress'].forEach(p => {
    document.getElementById('page-'+p).style.display = p===page ? '' : 'none';
  });
  document.querySelectorAll('nav button').forEach((b,i) => {
    b.classList.toggle('active', ['home','materials','progress'][i]===page);
  });
  if (page === 'materials') renderAllMaterials();
  if (page === 'progress') renderProgress();
}

// ============= FILE UPLOAD =============
function handleFileUpload(input, type) {
  const file = input.files[0];
  if (!file) return;
  const preview = document.getElementById('filePreview');
  preview.style.display = 'block';

  if (type === 'img') {
    const reader = new FileReader();
    reader.onload = e => {
      preview.innerHTML = `<div style="background:var(--card2);border-radius:12px;padding:1rem;border:1px solid var(--border)">
        <p style="font-family:Amiri;color:var(--accent2);margin-bottom:8px">ğŸ“¸ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©:</p>
        <img src="${e.target.result}" style="max-height:200px;border-radius:8px;max-width:100%">
        <p style="font-family:Amiri;color:var(--text-muted);font-size:0.8rem;margin-top:8px">ğŸ’¡ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø© ÙˆÙ„ØµÙ‚Ù‡ ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ù†Øµ Ø£Ø¹Ù„Ø§Ù‡ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø®Ø·Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</p>
      </div>`;
    };
    reader.readAsDataURL(file);
  } else {
    preview.innerHTML = `<div style="background:var(--card2);border-radius:12px;padding:1rem;border:1px solid var(--border);display:flex;align-items:center;gap:12px">
      <span style="font-size:2rem">ğŸ“„</span>
      <div>
        <p style="font-family:Amiri;color:var(--accent2)">ØªÙ… ØªØ­Ù…ÙŠÙ„: ${file.name}</p>
        <p style="font-family:Amiri;color:var(--text-muted);font-size:0.8rem">ğŸ’¡ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„Ù€ PDF ÙˆÙ„ØµÙ‚Ù‡ ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ù†Øµ Ø£Ø¹Ù„Ø§Ù‡</p>
      </div>
    </div>`;
  }
}

// ============= ADD MATERIAL =============
function addMaterial() {
  const title = document.getElementById('matTitle').value.trim();
  const type = document.getElementById('matType').value;
  const text = document.getElementById('matText').value.trim();
  const arabic = document.getElementById('matArabic').value.trim();

  if (!title) { showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø§Ø¯Ø©', 'error'); return; }
  if (!text && !arabic) { showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†Øµ', 'error'); return; }

  const mat = {
    id: Date.now(),
    title, type, text, arabic,
    date: new Date().toLocaleDateString('ar-IQ'),
    progress: 0,
    studyPlan: generateStudyPlan(title, type, text, arabic)
  };

  materials.unshift(mat);
  saveMaterials();
  renderMaterials();
  clearForm();
  showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰');
  
  // Auto open study plan
  setTimeout(() => openStudyPlan(mat.id), 500);
}

// ============= GENERATE STUDY PLAN =============
function generateStudyPlan(title, type, text, arabic) {
  const words = text ? text.split(/\s+/).filter(w=>w.length>3) : [];
  const keyWords = [...new Set(words)].slice(0, 20);
  
  const plans = {
    essay: {
      days: [
        {
          title: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„ - Ø§Ù„ÙÙ‡Ù… ÙˆØ§Ù„Ù…ÙØ±Ø¯Ø§Øª',
          badge: '90 Ø¯Ù‚ÙŠÙ‚Ø©',
          tasks: [
            'Ø§Ù‚Ø±Ø£ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ù…Ù„Ø§Ù‹ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¨ØªØ±ÙƒÙŠØ²',
            'Ø§Ø³ØªØ®Ø±Ø¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¹Ù†Ø§Ù‡Ø§',
            'Ø§ÙƒØªØ¨ ØªØ±Ø¬Ù…Ø© ÙƒÙ„ Ø¬Ù…Ù„Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ',
            'Ø­Ø¯Ø¯ Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„ÙØ±Ø¹ÙŠØ©',
            'Ø§Ù‚Ø±Ø£ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ© ÙˆØ£Ù†Øª ØªÙÙ‡Ù… Ø§Ù„Ù…Ø¹Ù†Ù‰'
          ]
        },
        {
          title: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø«Ø§Ù†ÙŠ - Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠ',
          badge: '60 Ø¯Ù‚ÙŠÙ‚Ø©',
          tasks: [
            'Ù‚Ø³Ù‘Ù… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ù„Ù‰ ÙÙ‚Ø±Ø§Øª (Ù…Ù‚Ø¯Ù…Ø© - Ø¹Ø±Ø¶ - Ø®Ø§ØªÙ…Ø©)',
            'Ø§Ø­ÙØ¸ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ø¬Ù…Ù„Ø© Ø¬Ù…Ù„Ø© Ù…Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± 5 Ù…Ø±Ø§Øª',
            'Ø§Ø­ÙØ¸ Ø§Ù„ÙÙ‚Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ù† Ø§Ù„Ø¹Ø±Ø¶',
            'Ø±Ø§Ø¬Ø¹ Ù…Ø§ Ø­ÙØ¸ØªÙ‡ Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©',
            'Ø§ÙƒØªØ¨ Ù…Ø§ Ø­ÙØ¸ØªÙ‡ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©'
          ]
        },
        {
          title: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø«Ø§Ù„Ø« - Ø§Ù„ØªØ«Ø¨ÙŠØª ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨',
          badge: '60 Ø¯Ù‚ÙŠÙ‚Ø©',
          tasks: [
            'Ø±Ø§Ø¬Ø¹ Ù…Ø§ Ø­ÙØ¸ØªÙ‡ Ø£Ù…Ø³',
            'Ø§Ø­ÙØ¸ Ø¨Ù‚ÙŠØ© ÙÙ‚Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¶',
            'Ø§Ø­ÙØ¸ Ø§Ù„Ø®Ø§ØªÙ…Ø©',
            'Ø§Ù‚Ø±Ø£ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ù…Ù„Ø§Ù‹ Ø¨ØµÙˆØª Ø¹Ø§Ù„Ù 3 Ù…Ø±Ø§Øª',
            'Ø³Ø¬Ù„ Ù†ÙØ³Ùƒ ÙˆÙ‚Ø§Ø±Ù† Ø¨Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ'
          ]
        },
        {
          title: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø±Ø§Ø¨Ø¹ - Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©',
          badge: '45 Ø¯Ù‚ÙŠÙ‚Ø©',
          tasks: [
            'Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ù…Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§Ø¹Ø¯Ø©',
            'ØµØ­Ø­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙˆØ±Ø§Ø¬Ø¹ Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹ Ø§Ù„ØµØ¹Ø¨Ø©',
            'Ø§Ù‚Ø±Ø£ Ø¨ØµÙˆØª Ø¹Ø§Ù„Ù Ù…Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø·Ù‚',
            'Ø§Ø´Ø±Ø­ ÙÙƒØ±Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ø´Ø®Øµ Ø¢Ø®Ø±',
            'Ø­ÙØ¸ ØªØ§Ù… âœ“'
          ]
        }
      ]
    },
    passage: {
      days: [
        {
          title: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„ - Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ§Ù„ÙÙ‡Ù…',
          badge: '75 Ø¯Ù‚ÙŠÙ‚Ø©',
          tasks: [
            'Ø§Ù‚Ø±Ø£ Ø§Ù„Ù‚Ø·Ø¹Ø© Ù…Ø±Ø© ÙƒØ§Ù…Ù„Ø© Ù„ÙÙ‡Ù… Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¹Ø§Ù…',
            'Ø­Ø¯Ø¯ Ø§Ù„Ù†ÙˆØ¹: ÙˆØµÙÙŠØ©ØŸ Ø³Ø±Ø¯ÙŠØ©ØŸ Ø¹Ù„Ù…ÙŠØ©ØŸ',
            'Ø§Ù‚Ø±Ø£ Ø«Ø§Ù†ÙŠØ© ÙˆØªÙˆÙ‚Ù Ø¹Ù†Ø¯ ÙƒÙ„ ÙÙ‚Ø±Ø© Ù„ØªÙ„Ø®ÙŠØµÙ‡Ø§ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ',
            'Ø§Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª Ø§Ù„ØµØ¹Ø¨Ø© ÙˆØ§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¹Ù†Ø§Ù‡Ø§',
            'Ø¶Ø¹ Ø£Ø³Ø¦Ù„Ø© Ù…ØªÙˆÙ‚Ø¹Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø·Ø¹Ø©'
          ]
        },
        {
          title: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø«Ø§Ù†ÙŠ - Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª ÙˆØ§Ù„Ù†Ø·Ù‚',
          badge: '60 Ø¯Ù‚ÙŠÙ‚Ø©',
          tasks: [
            'Ø±Ø§Ø¬Ø¹ Ù…Ø¹Ø§Ù†ÙŠ Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©',
            'ØªØ¯Ø±Ù‘Ø¨ Ø¹Ù„Ù‰ Ù†Ø·Ù‚ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØµØ¹Ø¨Ø©',
            'Ø§Ù‚Ø±Ø£ Ø§Ù„Ù‚Ø·Ø¹Ø© Ø¨ØµÙˆØª Ø¹Ø§Ù„Ù Ù…Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµØ­ÙŠØ­',
            'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ Ù„Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØµØ¹Ø¨Ø©',
            'Ø§ÙƒØªØ¨ Ø¬Ù…Ù„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„ÙƒÙ„ Ù…ÙØ±Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©'
          ]
        },
        {
          title: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø«Ø§Ù„Ø« - Ø§Ù„ÙÙ‡Ù… Ø§Ù„Ø¹Ù…ÙŠÙ‚',
          badge: '60 Ø¯Ù‚ÙŠÙ‚Ø©',
          tasks: [
            'Ø£Ø¬Ø¨ Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ÙÙ‡Ù… Ù…Ù† Ø§Ù„Ù‚Ø·Ø¹Ø©',
            'Ø­Ø¯Ø¯ Ø§Ù„Ø¬Ù…Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙŠ ÙƒÙ„ ÙÙ‚Ø±Ø©',
            'Ù„Ø®Ù‘Øµ Ø§Ù„Ù‚Ø·Ø¹Ø© Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙÙŠ 5 Ø¬Ù…Ù„',
            'ØªØ±Ø¬Ù… Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©',
            'Ø±Ø¨Ø· Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©'
          ]
        }
      ]
    },
    literature: {
      days: [
        {
          title: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„ - Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ',
          badge: '90 Ø¯Ù‚ÙŠÙ‚Ø©',
          tasks: [
            'ØªØ¹Ø±Ù‘Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ§ØªØ¨ ÙˆØ§Ù„Ø­Ù‚Ø¨Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ù„Ù†Øµ',
            'Ø§Ù‚Ø±Ø£ Ø§Ù„Ù‚Ø·Ø¹Ø© Ù…Ø±Ø© Ø£ÙˆÙ„Ù‰ Ø¨Ø¯ÙˆÙ† ØªÙˆÙ‚Ù',
            'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª Ø§Ù„Ø£Ø¯Ø¨ÙŠØ© ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©',
            'Ø­Ø¯Ø¯ Ø§Ù„Ø´Ø®ØµÙŠØ§Øª ÙˆØ§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
            'Ø§Ù‚Ø±Ø£ Ø«Ø§Ù†ÙŠØ© Ø¨ÙÙ‡Ù… Ù…Ø¹ Ø§Ù„ØªØ±Ø¬Ù…Ø©'
          ]
        },
        {
          title: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø«Ø§Ù†ÙŠ - Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø¨ÙŠ',
          badge: '75 Ø¯Ù‚ÙŠÙ‚Ø©',
          tasks: [
            'Ø­Ø¯Ø¯ Ù†ÙˆØ¹ Ø§Ù„Ù†Øµ: Ø´Ø¹Ø±ØŸ Ù‚ØµØ©ØŸ Ù…Ø³Ø±Ø­ÙŠØ©ØŸ',
            'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØµÙˆØ± Ø§Ù„Ø£Ø¯Ø¨ÙŠØ© (Ø§Ù„ØªØ´Ø¨ÙŠÙ‡ØŒ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø±Ø©)',
            'Ø­Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙˆØ§Ù„Ø±Ø³Ø§Ù„Ø©',
            'Ø§ÙƒØªØ¨ Ù…Ù„Ø®ØµØ§Ù‹ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ù„Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©',
            'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£Ø³Ø¦Ù„Ø© Ø§Ù…ØªØ­Ø§Ù†ÙŠØ© Ø³Ø§Ø¨Ù‚Ø©'
          ]
        },
        {
          title: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø«Ø§Ù„Ø« - Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ù†Ø·Ù‚',
          badge: '60 Ø¯Ù‚ÙŠÙ‚Ø©',
          tasks: [
            'Ø§Ø­ÙØ¸ Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©',
            'ØªØ¯Ø±Ù‘Ø¨ Ø¹Ù„Ù‰ Ù†Ø·Ù‚ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø£Ø¯Ø¨ÙŠØ©',
            'Ø§Ù‚Ø±Ø£ Ø¨ØµÙˆØª Ø¹Ø§Ù„Ù Ù…Ø¹ Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ø§Ù„ØµØ­ÙŠØ­',
            'Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©',
            'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø© âœ“'
          ]
        }
      ]
    }
  };

  return {
    ...plans[type],
    keywords: keyWords.map(w => ({
      en: w,
      ar: '',
      phonetic: generatePhonetic(w)
    })).slice(0, 15),
    tips: generateTips(type)
  };
}

function generatePhonetic(word) {
  // Simple phonetic approximation for Arabic speakers
  const map = {
    'a':'Ø£Ù','e':'Ø¥Ù','i':'Ø¥Ù','o':'Ø£Ù','u':'Ø£Ù',
    'th':'Ø°','sh':'Ø´','ch':'ØªØ´','ph':'Ù','wh':'Ùˆ',
    'tion':'Ø´Ù†','ness':'Ù†ÙØ³','ing':'Ø¥Ù†Øº','ment':'Ù…ÙÙ†Øª',
    'ful':'ÙÙÙ„','less':'Ù„ÙØ³','tion':'Ø´Ù†'
  };
  let ph = word.toLowerCase();
  Object.entries(map).forEach(([k,v]) => { ph = ph.replace(new RegExp(k,'g'), v); });
  return ph;
}

function generateTips(type) {
  const tips = {
    essay: [
      { title: 'ğŸ§  ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø±Ø¨Ø·', text: 'Ø§Ø±Ø¨Ø· ÙƒÙ„ Ø¬Ù…Ù„Ø© Ø¨ØµÙˆØ±Ø© Ø°Ù‡Ù†ÙŠØ© ÙˆØ§Ø¶Ø­Ø©. Ù…Ø«Ù„Ø§Ù‹: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù† Ø§Ù„Ù‡ÙˆØ§ÙŠØ©ØŒ ØªØ®ÙŠÙ‘Ù„ Ù†ÙØ³Ùƒ ØªÙ…Ø§Ø±Ø³Ù‡Ø§ ÙˆØ£Ù†Øª ØªÙ‚Ø±Ø£.' },
      { title: 'âœ‹ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©', text: 'Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ¯Ùƒ 3 Ù…Ø±Ø§Øª. Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„ÙŠØ¯ÙˆÙŠØ© ØªØ«Ø¨Øª Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¨Ù…Ø±ØªÙŠÙ†.' },
      { title: 'ğŸ¯ Ù‚Ø§Ø¹Ø¯Ø© 20 Ø¯Ù‚ÙŠÙ‚Ø©', text: 'Ù„Ø§ ØªØ­ÙØ¸ Ø£ÙƒØ«Ø± Ù…Ù† 20 Ø¯Ù‚ÙŠÙ‚Ø© Ù…ØªÙˆØ§ØµÙ„Ø©. Ø®Ø° Ø§Ø³ØªØ±Ø§Ø­Ø© 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ø«Ù… ÙƒØ±Ø±.' },
      { title: 'ğŸ”Š Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¬Ù‡Ø±ÙŠØ©', text: 'Ø§Ù‚Ø±Ø£ Ø¨ØµÙˆØª Ø¹Ø§Ù„Ù Ø¯Ø§Ø¦Ù…Ø§Ù‹. ÙŠØ³Ø§Ø¹Ø¯ Ø§Ù„Ø³Ù…Ø¹ ÙˆØ§Ù„Ø¨ØµØ± ÙˆØ§Ù„Ù†Ø·Ù‚ Ù…Ø¹Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„Ø³Ø±ÙŠØ¹.' }
    ],
    passage: [
      { title: 'ğŸ—ºï¸ Ø®Ø±ÙŠØ·Ø© Ø°Ù‡Ù†ÙŠØ©', text: 'Ø§Ø±Ø³Ù… Ø®Ø±ÙŠØ·Ø© Ø°Ù‡Ù†ÙŠØ© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ù‚Ø·Ø¹Ø©: Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ ÙˆØ§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø­ÙˆÙ„Ù‡Ø§.' },
      { title: 'â“ Ø§Ø³Ø£Ù„ Ù†ÙØ³Ùƒ', text: 'Ø¨Ø¹Ø¯ ÙƒÙ„ ÙÙ‚Ø±Ø© Ø§Ø³Ø£Ù„: Ù…Ø§Ø°Ø§ Ù‚Ø±Ø£ØªØŸ Ù…Ø§ Ø§Ù„ÙÙƒØ±Ø©ØŸ Ù‡Ø°Ø§ ÙŠÙ‚ÙˆÙŠ Ø§Ù„ÙÙ‡Ù… ÙˆØ§Ù„ØªØ°ÙƒØ±.' },
      { title: 'ğŸ“ Ø§Ù„ØªÙ„Ø®ÙŠØµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ', text: 'Ù„Ø®Ù‘Øµ ÙƒÙ„ ÙÙ‚Ø±Ø© ÙÙŠ Ø¬Ù…Ù„Ø© Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ø­Ø¯Ø©. ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙÙ‡Ù… Ø§Ù„Ø¹Ù…ÙŠÙ‚.' },
      { title: 'ğŸ” Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©', text: 'Ø§Ù‚Ø±Ø£ Ø§Ù„Ù‚Ø·Ø¹Ø© 3 Ù…Ø±Ø§Øª: Ù„Ù„ÙÙ‡Ù…ØŒ Ù„Ù„Ù…ÙØ±Ø¯Ø§ØªØŒ Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©.' }
    ],
    literature: [
      { title: 'ğŸ“… Ø§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ', text: 'Ø§ÙÙ‡Ù… Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ù„Ù†Øµ. ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ ÙÙ‡Ù… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙˆØ§Ù„Ø£Ø³Ù„ÙˆØ¨.' },
      { title: 'ğŸ­ ØªÙ‚Ù…Ù‘Øµ Ø§Ù„Ø´Ø®ØµÙŠØ§Øª', text: 'Ø­Ø§ÙˆÙ„ Ø£Ù† ØªØªØ®ÙŠÙ„ Ø£Ù†Ùƒ Ø§Ù„Ø´Ø®ØµÙŠØ© ÙÙŠ Ø§Ù„Ù†Øµ. ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ÙÙ‡Ù… Ø£Ø³Ù‡Ù„ ÙˆØ£Ù…ØªØ¹.' },
      { title: 'ğŸµ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ø¹ ÙˆØ§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰', text: 'Ù„Ù„Ø´Ø¹Ø±: Ø§Ù†ØªØ¨Ù‡ Ù„Ù„Ø¥ÙŠÙ‚Ø§Ø¹ ÙˆØ­Ø§ÙˆÙ„ Ø§Ù„Ø­ÙØ¸ Ø¨Ù†ÙØ³ Ø§Ù„Ù†ØºÙ…Ø© Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚ÙŠØ© Ù„Ù„Ø£Ø¨ÙŠØ§Øª.' },
      { title: 'ğŸ’¡ Ø§Ù„Ø±Ù…ÙˆØ² ÙˆØ§Ù„Ù…Ø¹Ø§Ù†ÙŠ', text: 'Ø§Ù„Ø£Ø¯Ø¨ Ù…Ù„ÙŠØ¡ Ø¨Ø§Ù„Ø±Ù…ÙˆØ². Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø¸Ø§Ù‡Ø± ÙˆØ§Ù„Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø®ÙÙŠ Ù„ÙƒÙ„ Ø¬Ù…Ù„Ø©.' }
    ]
  };
  return tips[type] || tips.essay;
}

// ============= RENDER =============
function renderMaterials() {
  const c = document.getElementById('materialsContainer');
  if (materials.length === 0) {
    c.innerHTML = `<div class="empty-state"><div class="icon">ğŸ“</div><p>Ù„Ù… ØªÙØ¶Ù Ø£ÙŠ Ù…Ø§Ø¯Ø© Ø¨Ø¹Ø¯. Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø¥Ù†Ø´Ø§Ø¡ Ø£Ùˆ Ù‚Ø·Ø¹Ø©!</p></div>`;
  } else {
    c.innerHTML = `<div class="materials-grid">${materials.slice(0,6).map(m=>materialCard(m)).join('')}</div>`;
  }
  updateStats();
}

function renderAllMaterials() {
  const c = document.getElementById('allMaterialsContainer');
  if (materials.length === 0) {
    c.innerHTML = `<div class="empty-state"><div class="icon">ğŸ“</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯. Ø§Ø±Ø¬Ø¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ£Ø¶Ù Ù…Ø§Ø¯Ø©!</p></div>`;
  } else {
    c.innerHTML = `<div class="materials-grid">${materials.map(m=>materialCard(m)).join('')}</div>`;
  }
}

function materialCard(m) {
  const t = typeMap[m.type] || typeMap.essay;
  return `<div class="material-card">
    <div><span class="card-type">${t.icon} ${t.label}</span></div>
    <div class="card-title">${m.title}</div>
    <div class="card-meta">ğŸ“… ${m.date} Â· ${m.text ? m.text.split(' ').length+' ÙƒÙ„Ù…Ø©' : 'Ù†Øµ Ù…Ø±ÙÙ‚'}</div>
    <div style="margin-bottom:1rem">
      <div class="progress-label" style="font-size:0.75rem;color:var(--text-muted)">
        <span>Ø§Ù„ØªÙ‚Ø¯Ù…</span><span>${m.progress}%</span>
      </div>
      <div class="progress-bar"><div class="progress-fill" style="width:${m.progress}%;background:linear-gradient(90deg,var(--accent),var(--green))"></div></div>
    </div>
    <div class="card-actions">
      <button class="btn btn-primary btn-sm" onclick="openStudyPlan(${m.id})">ğŸ“‹ Ø®Ø·Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</button>
      <button class="btn btn-secondary btn-sm" onclick="updateProgress(${m.id})">âœ“ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù…</button>
      <button class="btn btn-secondary btn-sm" onclick="deleteMaterial(${m.id})" style="color:var(--red)">ğŸ—‘ï¸</button>
    </div>
  </div>`;
}

function updateStats() {
  const total = materials.length;
  document.getElementById('totalMat').textContent = total;
  document.getElementById('essayCount').textContent = materials.filter(m=>m.type==='essay').length;
  document.getElementById('passageCount').textContent = materials.filter(m=>m.type==='passage').length;
  document.getElementById('litCount').textContent = materials.filter(m=>m.type==='literature').length;
  const avg = total ? Math.round(materials.reduce((a,m)=>a+m.progress,0)/total) : 0;
  document.getElementById('totalPct').textContent = avg+'%';
  document.getElementById('mainProgress').style.width = avg+'%';
}

// ============= STUDY PLAN MODAL =============
function openStudyPlan(id) {
  const mat = materials.find(m=>m.id===id);
  if (!mat) return;
  const plan = mat.studyPlan;
  const t = typeMap[mat.type];

  let daysHtml = plan.days.map((d,i) => `
    <div class="day-card">
      <div class="day-title">
        <h4>${d.title}</h4>
        <span class="day-badge">â± ${d.badge}</span>
      </div>
      <ul class="task-list">
        ${d.tasks.map((task,j) => `<li><span class="task-num">${j+1}</span><span>${task}</span></li>`).join('')}
      </ul>
    </div>`).join('');

  let tipsHtml = `<div class="tips-grid">${plan.tips.map(tip=>`
    <div class="tip-card">
      <h5>${tip.title}</h5>
      <p>${tip.text}</p>
    </div>`).join('')}</div>`;

  let vocabHtml = plan.keywords.length > 0 ? `
    <div class="pronunciation-box">
      <p style="font-family:Amiri;color:var(--accent2);margin-bottom:8px">ğŸ“š Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ø¹ Ø§Ù„Ù†Ø·Ù‚</p>
      <div class="pronunciation-words">
        ${plan.keywords.map(w=>`
          <div class="word-chip" onclick="speakWord('${w.en}')">
            <span class="eng">${w.en}</span>
            <span class="ar">/ ${w.phonetic} /</span>
            <button class="voice-btn" style="padding:3px 8px;font-size:0.7rem" onclick="event.stopPropagation();speakWord('${w.en}')">ğŸ”Š</button>
          </div>`).join('')}
      </div>
      <p style="font-family:Amiri;color:var(--text-muted);font-size:0.8rem;margin-top:10px">ğŸ’¡ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ ÙƒÙ„Ù…Ø© Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø¥Ù„Ù‰ Ù†Ø·Ù‚Ù‡Ø§</p>
    </div>` : '';

  let textHtml = mat.text ? `
    <div class="highlight-text">
      <p class="en-text" style="margin-bottom:1rem;line-height:1.8">${mat.text.substring(0,500)}${mat.text.length>500?'...':''}</p>
      ${mat.arabic ? `<hr style="border-color:var(--border);margin:1rem 0"><p class="ar-text">${mat.arabic}</p>` : ''}
    </div>` : '';

  document.getElementById('modalContent').innerHTML = `
    <div class="study-plan-header">
      <div><span class="card-type">${t.icon} ${t.label}</span></div>
      <h2>${mat.title}</h2>
      <div style="display:flex;align-items:center;justify-content:center;gap:10px;margin-top:0.5rem">
        <button class="voice-btn" onclick="speakText(\`${mat.text?.replace(/`/g,"'").substring(0,500)}\`)">ğŸ”Š Ø§Ø³ØªÙ…Ø¹ Ù„Ù„Ù†Øµ</button>
        <button class="voice-btn" style="color:var(--green);border-color:rgba(76,175,130,0.3);background:rgba(76,175,130,0.1)" onclick="speakTextArabic(\`${mat.arabic?.replace(/`/g,"'")}\`)">ğŸ”Š Ø§Ø³ØªÙ…Ø¹ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ</button>
      </div>
    </div>

    <div class="plan-tabs">
      <button class="plan-tab active" onclick="switchTab(this,'tab-plan')">ğŸ“‹ Ø®Ø·Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</button>
      <button class="plan-tab" onclick="switchTab(this,'tab-vocab')">ğŸ“š Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª ÙˆØ§Ù„Ù†Ø·Ù‚</button>
      <button class="plan-tab" onclick="switchTab(this,'tab-text')">ğŸ“„ Ø§Ù„Ù†Øµ</button>
      <button class="plan-tab" onclick="switchTab(this,'tab-tips')">ğŸ’¡ Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø­ÙØ¸</button>
    </div>

    <div id="tab-plan" class="plan-content active">${daysHtml}</div>
    <div id="tab-vocab" class="plan-content">${vocabHtml || '<p style="font-family:Amiri;color:var(--text-muted);text-align:center;padding:2rem">Ø£Ø¶Ù Ù†ØµØ§Ù‹ Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>'}</div>
    <div id="tab-text" class="plan-content">${textHtml || '<p style="font-family:Amiri;color:var(--text-muted);text-align:center;padding:2rem">Ù„Ù… ÙŠÙØ¶Ù Ù†Øµ Ø¨Ø¹Ø¯</p>'}</div>
    <div id="tab-tips" class="plan-content">${tipsHtml}</div>
  `;

  document.getElementById('studyModal').classList.add('open');
}

function switchTab(btn, tabId) {
  document.querySelectorAll('.plan-tab').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.plan-content').forEach(c=>c.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById(tabId).classList.add('active');
}

function closeModal() {
  document.getElementById('studyModal').classList.remove('open');
}

document.getElementById('studyModal').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});

// ============= TEXT TO SPEECH =============
function speakWord(word) {
  const u = new SpeechSynthesisUtterance(word);
  u.lang = 'en-US'; u.rate = 0.8;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

function speakText(text) {
  if (!text) return;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'en-US'; u.rate = 0.75;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

function speakTextArabic(text) {
  if (!text) return;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'ar-IQ'; u.rate = 0.85;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

// ============= PROGRESS =============
function updateProgress(id) {
  const mat = materials.find(m=>m.id===id);
  if (!mat) return;
  const pct = parseInt(prompt('Ø£Ø¯Ø®Ù„ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² (0-100):', mat.progress));
  if (!isNaN(pct) && pct >= 0 && pct <= 100) {
    mat.progress = pct;
    saveMaterials();
    renderMaterials();
    showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù… âœ“');
  }
}

function renderProgress() {
  const c = document.getElementById('progressContainer');
  if (!materials.length) {
    c.innerHTML = `<div class="empty-state"><div class="icon">ğŸ“Š</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ù„Ø¹Ø±Ø¶ ØªÙ‚Ø¯Ù…Ù‡Ø§</p></div>`;
    return;
  }
  c.innerHTML = `<div class="progress-card">
    ${materials.map(m=>`
      <div style="margin-bottom:1rem">
        <div class="progress-label">
          <span style="font-family:Amiri">${typeMap[m.type].icon} ${m.title}</span>
          <span>${m.progress}%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width:${m.progress}%;background:${m.progress>=80?'var(--green)':m.progress>=50?'var(--accent)':'var(--blue)'}"></div>
        </div>
      </div>`).join('')}
  </div>`;
}

// ============= DELETE =============
function deleteMaterial(id) {
  if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø©ØŸ')) return;
  materials = materials.filter(m=>m.id!==id);
  saveMaterials();
  renderMaterials();
  showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù');
}

// ============= UTILS =============
function clearForm() {
  document.getElementById('matTitle').value = '';
  document.getElementById('matText').value = '';
  document.getElementById('matArabic').value = '';
  document.getElementById('matType').value = 'essay';
  document.getElementById('filePreview').style.display = 'none';
}

function saveMaterials() {
  localStorage.setItem('eng_materials', JSON.stringify(materials));
}

function showToast(msg, type='success') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.style.background = type==='error' ? 'var(--red)' : 'var(--green)';
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

// ============= INIT =============
renderMaterials();
</script>

</body>
</html>
